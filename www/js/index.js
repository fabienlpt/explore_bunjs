function O(E){function h(q){q.stopPropagation();const{offsetX:Q,offsetY:X}=q,F=Math.min(Math.floor(Q/E.ui.cellSize),8),Y=Math.min(Math.floor(X/E.ui.cellSize),8),$=E.getSelectedCell();if($===null||$[0]!==F||$[1]!==Y)E.setSelectedCell([F,Y]),E.refreshGrid()}function B(q){if(q.stopPropagation(),E.getSelectedCell()!==null)E.setSelectedCell(null),E.refreshGrid()}function N(q){if(q.stopPropagation(),q.key>="1"&&q.key<="9"&&E.getSelectedCell()!==null)E.toggle(parseInt(q.key))}E.canvas.addEventListener("mousemove",h),E.canvas.addEventListener("mouseout",B),document.onkeyup=N}class R{E;h;static _uis=new WeakMap;static bgColor="#DDD";static thinLineColor="#AAA";static boldLineColor="#000";static impactedColor="#eec";static selectedColor="#ff6";static get(E){if(R._uis.has(E))return R._uis.get(E);const h=E.getContext("2d");if(h===null)return!1;const B=new R(E,h);return R._uis.set(E,B),B}_cellSize;constructor(E,h){this._canvas=E;this._ctx=h;this._cellSize=Math.round(Math.min(E.width,E.height)/9)}get width(){return this._canvas.width}get height(){return this._canvas.height}get cellSize(){return this._cellSize}clearCanvas(){return this._ctx.fillStyle=R.bgColor,this._ctx.fillRect(0,0,this.width,this.height),this}drawCell(E,h,B=this._cellSize,N=R.thinLineColor,q){const Q=E*B,X=h*B;if(q)this._ctx.fillStyle=q,this._ctx.fillRect(Q+1,X+1,B-2,B-2);return this._ctx.strokeStyle=N,this._ctx.strokeRect(Q,X,B,B),this}drawRow(E,h){for(let B=0;B<9;B++)this.drawCell(B,E,this._cellSize,R.thinLineColor,h);return this}drawColumn(E,h){for(let B=0;B<9;B++)this.drawCell(E,B,this._cellSize,R.thinLineColor,h);return this}drawGroup(E,h,B){this.drawCell(E,h,this._cellSize*3,R.boldLineColor,B);for(let N=0;N<3;N++)for(let q=0;q<3;q++)this.drawCell(E*3+q,h*3+N,this._cellSize,R.thinLineColor);return this}drawCellValue(E,h,B){this._ctx.fillStyle="#000",this._ctx.font="bold 60px Arial",this._ctx.textBaseline="middle",this._ctx.textAlign="center";const N=E*this._cellSize+Math.floor(this._cellSize*0.5),q=h*this._cellSize+Math.floor(this._cellSize*0.575);return this._ctx.fillText(B.toString(),N,q),this}drawCellDomain(E,h,B){this._ctx.fillStyle="#000",this._ctx.font="16px Arial",this._ctx.textBaseline="top",this._ctx.textAlign="start";const N=Math.max(this._cellSize-2,Math.floor(this._cellSize*0.8)),q=Math.floor(N/3),Q=Math.max(1,Math.floor(this._cellSize*0.1)),X=E*this._cellSize+Q,F=h*this._cellSize+Q;for(let Y=1;Y<=9;Y++){const $=B.includes(Y)?Y:null,M=(Y-1)%3,_=Math.floor((Y-1)/3),T=X+q*M,K=F+q*_;this._ctx.fillText($!==null?$.toString():"",T,K)}return this}drawEmptyGrid(){this.clearCanvas();for(let E=0;E<3;E++)for(let h=0;h<3;h++)this.drawGroup(h,E);return this}colorizeSelectedStuff(E){if(E===null)return this;const h=[Math.floor(E[0]/3),Math.floor(E[1]/3)];return this.drawRow(E[1],R.impactedColor).drawColumn(E[0],R.impactedColor).drawGroup(h[0],h[1],R.impactedColor).drawCell(E[0],E[1],this._cellSize,R.thinLineColor,R.selectedColor),this}}function w(){const E=new WebSocket(`ws://${location.host}`);E.onopen=()=>setInterval(()=>E.send("ping"),5000),E.onmessage=(h)=>{if(h.data!=="Well received")console.log(h.data);if(h.data==="reload")location.reload()}}class P{values;constructor(E){this.values=new Set(E)}addValue(E){this.values.add(E)}hasValue(E){return this.values.has(E)}delValue(E){this.values.delete(E)}copy(){return new P(Array.from(this.values))}toJSON(){return Array.from(this.values)}static fromJSON(E){return new P(E)}}var g=function(E){const h=document.getElementById(E);if(h===null)return console.error("Cannot get the given Canvas 2D rendering context"),!1;const B=R.get(h);if(!B)return!1;const N=[],q=[];for(let Q=0;Q<9;Q++){N.push([]),q.push([]);for(let X=0;X<9;X++)N[Q].push(new P([1,2,3,4,5,6,7,8,9])),q[Q].push(null)}return{canvas:h,ui:B,cellDomains:N,cellValues:q}},z=function(E){const{canvas:h,ui:B,cellDomains:N,cellValues:q}=E;let Q=null;function X(K,L){if(q[L][K]!==null)B.drawCellValue(K,L,q[L][K]);else B.drawCellDomain(K,L,N[L][K].toJSON())}function F(){for(let K=0;K<9;K++)for(let L=0;L<9;L++)X(L,K)}function Y(K,L,W){N[L][K].delValue(W)}function $(K,L,W){N[L][K].addValue(W)}function M(K,L,W,H){const A=H?Y:$;for(let Z=0;Z<9;Z++){if(Z!==K)A(Z,L,W);if(Z!==L)A(K,Z,W)}const f=Math.floor(K/3),b=Math.floor(L/3);for(let Z=0;Z<3;Z++)for(let J=0;J<3;J++){const x=f*3+J,y=b*3+Z;if(x!==K&&y!==L)A(x,y,W)}}function _(K){const L=Q[0],W=Q[1];if(q[W][L]===null){if(N[W][L].hasValue(K))q[W][L]=K,M(L,W,K,!0),T()}else if(q[W][L]===K){q[W][L]=null,M(L,W,K,!1);for(let H=0;H<9;H++)for(let A=0;A<9;A++)if(q[H][A]===K)M(A,H,K,!0);T()}}function T(){B.drawEmptyGrid().colorizeSelectedStuff(Q),F()}O({canvas:h,ui:B,refreshGrid:T,toggle:_,getSelectedCell:()=>Q,setSelectedCell:(K)=>Q=K}),w(),T()},G=g("sudokuCanvas");if(G)z(G);
